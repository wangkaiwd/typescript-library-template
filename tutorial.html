<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>打包TypeScript库文件并发布到npm | TypeScript Library Template</title>
    <meta name="description" content="Write TypeScript Library without extra ">
    <link rel="stylesheet" href="/typescript-library-template/assets/style.676656a2.css">
    <link rel="modulepreload" href="/typescript-library-template/assets/Home.0601de62.js">
    <link rel="modulepreload" href="/typescript-library-template/assets/app.795c05b9.js">
    <link rel="modulepreload" href="/typescript-library-template/assets/tutorial.md.9f664e02.lean.js">
    
    <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/wangkaiwd/drawing-bed/master/81249231_padded_logo.png">
  <meta name="twitter:title" content="打包TypeScript库文件并发布到npm | TypeScript Library Template">
  <meta property="og:title" content="打包TypeScript库文件并发布到npm | TypeScript Library Template">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/typescript-library-template/" aria-label="TypeScript Library Template, back to home" data-v-675d8756 data-v-cc01ef16><img class="logo" src="https://raw.githubusercontent.com/wangkaiwd/drawing-bed/master/81249231_padded_logo.png" alt="Logo" data-v-cc01ef16> TypeScript Library Template</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/wangkaiwd/typescript-library-template" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/wangkaiwd/typescript-library-template" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/typescript-library-template/">快速上手</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/typescript-library-template/tutorial">打包和发布</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#打包typescript库文件并发布到npm">打包TypeScript库文件并发布到npm</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#使用rollup打包typescript代码">使用rollup打包TypeScript代码</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#修改npm相关配置">修改npm相关配置</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#发布代码到npm">发布代码到npm</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#通过node-js来自动化发布">通过Node.js来自动化发布</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#结语">结语</a><!----></li></ul></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h2 id="打包typescript库文件并发布到npm" tabindex="-1">打包<code>TypeScript</code>库文件并发布到<code>npm</code> <a class="header-anchor" href="#打包typescript库文件并发布到npm" aria-hidden="true">#</a></h2><p><img src="https://raw.githubusercontent.com/wangkaiwd/drawing-bed/master/Colorful%20Brushstrokes%20Artists%20and%20Illustrators%20Collection%20YouTube%20Intro.png" alt=""></p><p>本文讲解了如何使用<code>rollup</code>打包<code>TypeScript</code>代码以及发布打包文件到<code>npm</code>，并最终自动化发布过程。涉及到的技术栈如下：</p><ul><li><code>rollup</code></li><li><code>TypeScript</code></li><li><code>npm</code></li><li><code>Node.js</code></li></ul><p>由于整个项目搭建过程过于繁琐，笔者创建了一个<a href="https://github.com/wangkaiwd/typescript-library-template" target="_blank" rel="noopener noreferrer">模板项目</a> ，来帮助开发者快速创建项目，本文记录了实现的具体过程。如果你也有类似需求的话，可以参考文章内容了解具体步骤，也可以直接使用模板项目，跳过繁琐的配置环节。</p><h3 id="使用rollup打包typescript代码" tabindex="-1">使用<code>rollup</code>打包<code>TypeScript</code>代码 <a class="header-anchor" href="#使用rollup打包typescript代码" aria-hidden="true">#</a></h3><p>首先我们需要先安装相关依赖</p><div class="language-shell"><pre><code><span class="token function">npm</span> i typescript rollup rollup-plugin-typescript2 tslib -D
</code></pre></div><p>这里需要使用<code>rollup-plugin-typescript2</code>来让<code>rollup</code>能够打包<code>TypeScript</code>代码，<code>rollup</code>的具体配置如下：</p><div class="language-javascript"><pre><code><span class="token keyword">import</span> typescript <span class="token keyword">from</span> <span class="token string">&#39;rollup-plugin-typescript2&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> mode <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MODE</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> isProd <span class="token operator">=</span> mode <span class="token operator">===</span> <span class="token string">&#39;prod&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./package.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">lib/index.ts</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">file</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span>main<span class="token punctuation">,</span>
      <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token string">&#39;named&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;cjs&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token operator">!</span>isProd
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">file</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span>module<span class="token punctuation">,</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;es&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token operator">!</span>isProd
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">&#39;build/my-lib.global.js&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;MyLib&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">&#39;iife&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token operator">!</span>isProd
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">typescript</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">useTsconfigDeclarationDir</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">tsconfigOverride</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">compilerOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">sourceMap</span><span class="token operator">:</span> <span class="token operator">!</span>isProd <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>在<code>rollup</code>的配置文件中，我们通过<code>output</code> 中的<a href="https://rollupjs.org/guide/en/#outputformat" target="_blank" rel="noopener noreferrer"><code>format</code></a> 来分别生成<code>commonjs</code>、<code>esModule</code>以及支持直接通过<code>script</code>在<code>html</code>中引入 的<code>iife</code>( 立即调用函数表达式)。即用户可以通过以下方式来使用打包后的代码：</p><div class="language-javascript"><pre><code><span class="token comment">// esModule</span>
<span class="token keyword">import</span> MyLib <span class="token keyword">from</span> <span class="token string">&#39;my-lib&#39;</span>
<span class="token comment">// commonjs</span>
<span class="token keyword">const</span> MyLib <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;my-lib&#39;</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-html"><pre><code><span class="token comment">&lt;!-- iife --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>node_modules/my-lib/build/my-lib.global.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;MyLib&#39;</span><span class="token punctuation">,</span> MyLib<span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>当我们通过<code>script</code>进行引入时，提供的全局变量是在<code>output</code>数组中<code>format:iife</code>对应的<code>name</code>属性，之后用户便可以通过这个全局变量来实现相应的需求。</p><p>除了提供相应的功能，由于我们使用了<code>TypeScript</code>，也应该让同样使用<code>TypeScript</code>的用户能够进行类型提示，相应配置如下：</p><div class="language-javascript"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">typescript</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">useTsconfigDeclarationDir</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">tsconfigOverride</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">compilerOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">sourceMap</span><span class="token operator">:</span> <span class="token operator">!</span>isProd <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里会使用<code>tsconfig.json</code>中的配置来打包代码，并且会覆盖掉<code>tsconfig.json</code>中的<code>sourceMap</code>，保证只在开发环境生成<code>sourceMap</code>文件，方便代码调试。</p><p>相应的<code>tsconfig.json</code>中也需要提供如下配置：</p><div class="language-json"><pre><code><span class="token punctuation">{</span>
  <span class="token comment">// ... some other config</span>
  <span class="token comment">// 打包生成ES5代码</span>
  <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ES5&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 生成类型声明文件</span>
  <span class="token property">&quot;declaration&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// 类型声明文件目录  </span>
  <span class="token property">&quot;declarationDir&quot;</span><span class="token operator">:</span> <span class="token string">&quot;build/types&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里<code>target: &quot;ES5&quot;</code>可以帮我们将代码打包为<code>ES5</code>的语法，所以这里不用再使用<code>babel</code>来进行语法转换了。</p><p>最后要在<code>package.json</code>中指定<code>js</code>入口文件以及类型入口文件：</p><div class="language-json"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;build/my-lib.cjs.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;build/my-lib.es.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token string">&quot;build/my-lib/types/index.d.ts&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><ul><li><code>module</code>字段并不是<code>package.json</code>中预先指定的字段，而是自定义字段。不过<code>webpack</code>,<code>rollup</code>等打包器都可以识别该字段，从而优先使用<code>esModule</code>格式。</li><li>有些开源库也将<code>types</code>字段定义为<code>typings</code>，俩者含义完全相同</li></ul></blockquote><p>接下来在<code>npm</code>中添加如下<code>scripts</code>:</p><div class="language-json"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rollup -w -c rollup.config.ts --environment MODE:dev&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rollup -c rollup.config.ts --environment MODE:prod&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>执行<code>npm run dev</code>便可以进入开发模式，书写代码并实时编译。</p><h3 id="修改npm相关配置" tabindex="-1">修改npm相关配置 <a class="header-anchor" href="#修改npm相关配置" aria-hidden="true">#</a></h3><p>在发布之前，要修改一些<code>package.json</code>中的相关配置配置。</p><ul><li><code>name: my-lib</code></li></ul><p><code>package.json</code>中的<code>name</code>用来表示我们包的名字，发布到<code>npm</code>之后，其它开发者便可以通过<code>npm install my-lib</code>来进行安装。</p><p>由于命名冲突问题，有很多包会放到一个组织下，此时<code>name</code>属性会以<code>@组织名</code>为前缀。一般公司内部也会有自己的组织，包文件都会放到该组织下。以<code>vue</code>为例，其中<code>reactivity</code>的<code>name</code> 字段为：<code>@vue/reactivity</code>。</p><ul><li><code>private:false</code>： 要将<code>private</code>设置为<code>false</code>，否则发布会出错</li></ul><p>发布到<code>npm</code>中的代码便是用户真正使用的代码，而有很多文件只是在开发时使用。为了排除生产环境中不会用到的代码文件，<code>npm</code>为我们提供了以下俩种方法：</p><ul><li><code>.npmignore</code>文件</li><li><code>package.json</code>中的<code>files</code>字段</li></ul><p><code>.npmignore</code>文件可以忽略发布到<code>npm</code>中不需要的文件，而<code>files</code>恰好相反，可以通过这个字段来指定发布到<code>npm</code>时要包含哪些文件。</p><p>通常我们只需要配置<code>files</code>字段，把打包后的文件用来发布即可：</p><div class="language-json"><pre><code><span class="token punctuation">{</span>
  <span class="token property">&quot;files&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;build&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="发布代码到npm" tabindex="-1">发布代码到<code>npm</code> <a class="header-anchor" href="#发布代码到npm" aria-hidden="true">#</a></h3><p>为了能让更多的人使用我们写好的代码，我们可以将代码发布到<code>npm</code>，这样所有的开发者都可以通过<code>npm install</code>来进行安装。</p><p>要发布代码，首先需要将最先的代码进行打包。由于打包后生成的类型文件比较分散，这里我们使用<a href="https://github.com/microsoft/rushstack/tree/master/apps/api-extractor" target="_blank" rel="noopener noreferrer"><code>@microsoft/api-extractor</code></a> 将打包后生成的类型声明文件整合为一个单独的文件，之后将原有类型声明文件删除。</p><p>发布之前，首先需要通过执行<code>npm version &lt;newversion&gt;</code>来增加<code>package.json</code>以及<code>package-lock.json</code>中的版本号。需要注意的是，<strong>该命令会帮我们创建一个<code>git commit</code>, 并且使用新的版本号创建<code>git tag</code></strong></p><p>在<code>version</code>升级后，可以通过<a href="https://github.com/conventional-changelog/conventional-changelog" target="_blank" rel="noopener noreferrer"><code>Conventional Changelog</code></a> 生成更改日志</p><p>版本提升以后，便可以执行<code>npm publish</code>来进行发布。如果提示未登录，需要执行<code>npm login</code>登录后再执行<code>npm publish</code>。由于日常开发时，大多数人都会使用淘宝源来安装依赖，在发布时要记得将<strong>淘宝源切换为<code>npm</code> 官方源</strong>。</p><p>发布<code>npm</code>完成之后，将<code>changelog.md</code>的最新改动提交到<code>git</code>，然后将所有更改以及创建的版本号<code>tag</code>提交到<code>GitHub</code>远程仓库。</p><p>发布完成后，我们可能想看一下到底上传了哪些代码到<code>npm</code>，这里推荐以下俩种方式：</p><ul><li>在项目根目录执行<code>npm pack</code>，会生成最终用户安装到<code>node_modules</code>下的代码</li><li>通过<a href="https://github.com/pd4d10/npmview" target="_blank" rel="noopener noreferrer"><code>npmview</code></a> 来在线搜索查看自己发布到<code>npm</code>的包文件</li></ul><h3 id="通过node-js来自动化发布" tabindex="-1">通过<code>Node.js</code>来自动化发布 <a class="header-anchor" href="#通过node-js来自动化发布" aria-hidden="true">#</a></h3><p>在日常的开发中，发布功能会被不停的使用，那么我们就得每次重复上述的工作。在重复的过程中，很有可能因为某次的不小心，而导致某个步骤出错或者漏掉。如忘记在发布之前将<code>npm</code>源设置为官方源、发布之前忘记打包等等问题。</p><p>借助<code>Node.js</code>，我们可以将发布流程进行自动化，只需在命令行执行<code>npm run release</code>便可以让程序自动处理发布时要做的一些工作。</p><p>在自动化之前，将整个发布流程梳理一下：</p><ol><li><code>npm run build</code> 生成打包文件，并利用<a href="https://github.com/microsoft/rushstack/tree/master/apps/api-extractor" target="_blank" rel="noopener noreferrer"><code>@microsoft/api-extractor</code></a> 将类型声明文件合并到一个文件</li><li><code>npm version newversion</code>提升版本号(同时也会创建一个<code>commit</code>以及<code>tag</code>)</li><li><code>npm run genlog</code>生成<code>changlog.md</code>文件来记录更改</li><li>提交<code>changelog.md</code>的最新改动到<code>git</code></li><li><code>npm publish --reg=https://registry.npmjs.org</code>使用<code>npm</code>官方源来发布代码</li><li>将最新的改动以及新创建的<code>tag</code>提交到<code>github</code><ul><li><code>git push</code>: 推送代码到远程仓库</li><li><code>git push origin tagName</code>: <code>tag</code>需要单独提交</li></ul></li></ol><p>整个过程中我们会用到以下工具库：</p><ul><li><a href="https://github.com/sindresorhus/execa" target="_blank" rel="noopener noreferrer"><code>execa</code></a>: 通过<code>Node.js</code>子进程来执行命令行代码</li><li><a href="https://github.com/enquirer/enquirer" target="_blank" rel="noopener noreferrer"><code>enquirer</code></a>: 可以让<code>Node.js</code>与命令行进行交互，如输入或者选择内容</li><li><a href="https://github.com/chalk/chalk" target="_blank" rel="noopener noreferrer"><code>chalk</code></a>: 设置终端字符串样式</li><li><a href="https://github.com/substack/minimist" target="_blank" rel="noopener noreferrer"><code>minimist</code></a>: 解析命令行参数</li><li><a href="https://github.com/npm/node-semver" target="_blank" rel="noopener noreferrer"><code>semver</code></a>: 处理语义化版本相关逻辑</li></ul><p>核心逻辑便是通过<a href="https://github.com/sindresorhus/execa" target="_blank" rel="noopener noreferrer"><code>execa</code></a> 执行命令行代码，一步步完成我们的发布过程，期间会通过<a href="https://github.com/enquirer/enquirer" target="_blank" rel="noopener noreferrer"><code>enquirer</code></a> 来让用户选择或输入新的版本号。整个过程提供了<code>dry</code> 模式，在命令行中执行<code>npm run release -- --dryRun</code> 便可以通过日志来查看发布的整个流程，而不会触发真正对应的操作，方便调试</p><p><img src="https://raw.githubusercontent.com/wangkaiwd/drawing-bed/master/20220116191521.png" alt=""></p><p>想要查看源代码的小伙伴可以<a href="https://github.com/wangkaiwd/typescript-library-template/blob/main/scripts/release.js" target="_blank" rel="noopener noreferrer">点击这里</a> 。</p><p>最终我们在命令行执行<code>npm run release</code>，根据提示输入或选择新的版本号，等到命令行提示发布成功，便可以在<code>npm</code>中看到我们发布的包了。</p><h3 id="结语" tabindex="-1">结语 <a class="header-anchor" href="#结语" aria-hidden="true">#</a></h3><p>之前笔者在开发公用的代码库时，对整个打包和发布过程一知半解，最终决定学习其中涉及到的相关知识点， 并参考<code>Vue3</code> 的<a href="https://github.com/vuejs/vue-next/blob/f4f0966b33863ac0fca6a20cf9e8ddfbb311ae87/scripts/release.js?_pjax=%23js-repo-pjax-container%2C%20div%5Bitemtype%3D%22http%3A%2F%2Fschema.org%2FSoftwareSourceCode%22%5D%20main%2C%20%5Bdata-pjax-container%5D" target="_blank" rel="noopener noreferrer">源码</a> 实现了满足需求的发布脚本。如果你也想了解发布过程中的一些知识，希望本文可以帮到你。</p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><!----></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/typescript-library-template/" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>快速上手</span></a></div><div class="next" data-v-38ede35f><!----></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"289ecf1a\",\"tutorial.md\":\"9f664e02\"}")</script>
    <script type="module" async src="/typescript-library-template/assets/app.795c05b9.js"></script>
    
  </body>
</html>